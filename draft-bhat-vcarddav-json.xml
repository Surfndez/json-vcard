<?xml version="1.0"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">
<?rfc compact="yes"?>
<?rfc strict="yes"?>
<?rfc symrefs="yes"?>
<?rfc toc="yes"?>
<?rfc tocdepth="4"?>
<rfc category="std" docName="draft-ietf-vcarddav-json-00" ipr="trust200902">

  <front>
    <title abbrev="vCard in JSON">A JavaScript Object Notation (JSON) Representation for vCard</title>
    <author initials="R." surname="Bhat" fullname="Raghurama Bhat">
      <organization>Cisco Systems, Inc.</organization>
      <address>
        <postal>
          <street>900 McCarthy Blvd.</street>
          <city>Milpitas</city>
          <region>CA</region>
          <code>95035</code>
          <country>USA</country>
        </postal>
        <phone>+1-408-902-2123</phone>
        <email>ragbhat@cisco.com</email>
      </address>
    </author>
    <author initials="P." surname="Saint-Andre" fullname="Peter Saint-Andre">
      <organization>Cisco Systems, Inc.</organization>
      <address>
        <postal>
          <street>1899 Wynkoop Street, Suite 600</street>
          <city>Denver</city>
          <region>CO</region>
          <code>80202</code>
          <country>USA</country>
        </postal>
        <phone>+1-303-308-3282</phone>
        <email>psaintan@cisco.com</email>
      </address>
    </author>
    <date year="2012" month="May" day="29"/>
    <keyword>vCard</keyword>
    <keyword>JSON</keyword>
    <abstract>
      <t>This document defines a representation of vCard data in JavaScript Object Notation (JSON).</t>
    </abstract>
  </front>

  <middle>

    <section title="Introduction" anchor="intro">
      <t>vCard <xref target='RFC6350'/> is a data format for representing and exchanging information about individuals and other entities.  It is a text-based format (as opposed to a binary format).  This document defines a representation for vCard data in JavaScript Object Notation (JSON), a lightweight, text-based, language-independent data interchange format derived from the ECMAScript Programming Language Standard (see <xref target='RFC4627'/>).  As with the XML representation of vCard defined in <xref target='RFC6351'/>, the data structure is exactly the same as for plain vCard, enabling a 1-to-1 mapping between the original vCard format and the JSON representation (or the XML representation).  The JSON formatting might be preferred in some contexts where JSON facilities are readily available and can be reused instead of writing a standalone vCard parser.</t>
    </section>

    <section title="Discussion Venue" anchor="venue">
      <t>The preferred discussion venue for this document is the vcarddav@ietf.org mailing list, for which subscription information and archives can be found at <eref target='https://www.ietf.org/mailman/listinfo/vcarddav'/>.</t>
    </section>

    <section title="Terminology" anchor="terms">
      <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <xref target='RFC2119'/>.</t>
    </section>

    <section title="Example" anchor="example">
      <t>To ease comparison with both plain vCard and the XML representation, the following example is a JSON representation of the same vCard (for Simon Perreault) that is also shown in <xref target='RFC6350'/> and <xref target='RFC6351'/>.</t>
      <figure anchor='figure-1' title='vCard representation of RFC 6350 example'>
        <artwork><![CDATA[
{
    "version":"4.0",
    "fn":  "Simon Perreault",
    "n": {
        "surname": "Simon",
        "given": "Perreault",
        "suffix": [ "ing. jr", "M.Sc."]
    },
    "bday": { "date": "--0203" },
    "anniversary": { "date-time": "20090808T1430-0500" },
    "gender": { "sex" : "M" },
    "lang": [ 
      {
        "pref": 1,
        "text": "fr",
      },
      {
        "pref": 2,
        "text": "en",
      },
    ],
    "org": 
      {
        "type": "work",
        "text": "Viagenie"
      },
    "adr": 
      {
        "type": "work",
        "label": "Simon Perreault
           2875 boul. Laurier, suite D2-630
           Quebec, QC, Canada
           G1V 2M2",
      "street": "2875 boul. Laurier, suite D2-630",
      "locality": "Quebec",
      "region": "QC",
      "code": "G1V 2M2",
      "country": "CA"
      },
    "tel": [ 
      {
        "type":  ["work", "voice"],
        "uri": "tel:+1-418-656-9254;ext=102"
      },
      {
        "type": ["work", "text", "voice", "cell", "video"],
        "uri": "tel:+1-418-262-6501"
      }
    ],
    "email": {
        "type": "work",
        "text": "simon.perreault@viagenie.ca"
    },
    "geo": {
      "type": "work",
      "uri": "geo:46.766336,-71.28955"
    },
    "key": {
      "type": "work",
      "uri": "http://www.viagenie.ca/simon.perreault/simon.asc"
    },
    "tz": "America/Los_Angeles",
    "url": {
      "type": "home",
      "uri": "http://nomis80.org"
    }
}
        ]]></artwork>
      </figure>
    </section>

    <section title="Design Considerations" anchor="design">
      <t>The general idea is to map vCard parameters, properties and value types to JSON property/value pairs. For example, the "FN" property is mapped to the fn property. Value contains a text string that corresponds to the vCard property's value. vCard parameters are also mapped to JSON objects which are contained in the value object.  For example, the "TYPE" parameter applied to the "TEL" property would look like the following in JSON.</t>
      <figure anchor='figure-2' title='Mapping of a vCard parameter'>
        <artwork><![CDATA[
  "tel": {
      "type": [ "voice", "video" ],
      "uri": "tel:+1-555-555-555"
  }
        ]]></artwork>
      </figure>

      <t>Parameters taking a list of values and properties with cardinality of more than one are converted to a JSON array object.  Properties having structured values (e.g., the "N" property) are expressed by nested JSON object trees. Property names in that tree (e.g.,"surname", "given", etc.) do not have a vCard equivalent since they are identified by position in plain vCard.  Line folding is a non-issue in JSON.  Therefore, the mapping from vCard to JSON is done after the unfolding procedure is carried out. Conversely, the mapping from JSON to vCard is done before the folding procedure is carried out. The group construct (Section 3.2 in [RFC6350]) is represented with the JSON object of the same name.  For example:</t>
      <figure anchor='figure-3' title='Mapping of lists and structured values'>
        <artwork><![CDATA[

  {
      "version" : "4.0"
      "contact": {
          "fn": "...",
          "email": "..."
      },
      "media" : {
        "photo": "..."
        },
      "categories": "..."
  }
        ]]></artwork>
      </figure>
      <t>... is equivalent to:</t>
      <figure anchor='figure-4' title='Plain vCard equivalent'>
        <artwork><![CDATA[
BEGIN:VCARD
VERSION:4.0
contact.FN=...
contact.EMAIL=...
media.PHOTO=...
CATEGORIES=...
END:VCARD
        ]]></artwork>
      </figure>
        <t>VALUE parameter from the original VCARD format is used as the property name in the JSON format. If there is no VALUE parameter specified, it is treated as equivalent to VALUE=text. For example:</t>
        <figure anchor='figure-5' title='Mapping of VALUE parameter'>
            <artwork><![CDATA[
{
    "email": {
        "type": "work",
        "text": "simon.perreault@viagenie.ca"
    },
    "geo": {
      "type": "work",
      "uri": "geo:46.766336,-71.28955"
    },
    "bday": { "date": "--0203" },
}
        ]]></artwork>
        </figure>
        <t>... is equivalent to:</t>
        <figure anchor='figure-6' title='Plain vCard equivalent'>
            <artwork><![CDATA[
BEGIN:VCARD
VERSION:4.0
EMAIL;VALUE=text;type=work:simon.perreault@viagenie.ca
GEO;VALUE=uri;type=work:geo:46.766336,-71.28955
BDATE;VALUE=date:--0203
END:VCARD
        ]]></artwork>
        </figure>

    </section>

    <section title="Extensibility" anchor="extensibility">
      <t> The original vCard format is extensible.  New properties, parameters,data types and values (collectively known as vCard elements, not to be confused with XML elements) can be registered with IANA (see [RFC6350], Section 10.2).  It is expected that these vCard extensions will also specify extensions to the JSON format described in this document.  New JSON vCard property and parameter element names MUST be lower-case.  This is necessary to ensure that round-tripping between JSON and plain-text vCard works correctly.  Unregistered extensions (i.e., those starting with "X-" and "VND-...-") are expressed in JSON by using properties starting with "x-" and "vnd-...-". Refer to Section 6 for the implications when converting between plain-text vCard and JSON.  For example:</t>
      <figure anchor='figure-7' title='An example of extensibility'>
        <artwork><![CDATA[
{
"x-my-prop": {
    "pref":  1,
    "text": "value goes here"
  }
}
        ]]></artwork>
      </figure>
      <t>A vCard JSON parser MUST ignore JSON properties and values for which it doesn't recognize the expanded name.  In the original vCard format, the "VERSION" property was mandatory and played a role in extensibility. In XML, this property was dropped in favor of the XML namespace mechanism. In JSON mapping, we reintroduce the "version" property. It plays a similar role as in the original vCard format.  Parameters containing a list of values are expressed using a array of objects in JSON.</t>
      </section>
      <section title="Limitations" anchor="limitations">
          <t>
              The JSON format does not validate the cardinality of properties.  This is a limitation of the JSON format specification.  Cardinalities of the original vCard format [RFC6350] MUST still be respected.
          </t>
      </section>

    <section title="Format Conversions" anchor="conversions">
      <t> To follow</t>
    </section>

    <section title="Security Considerations" anchor="security">
      <t>All the security considerations applicable to plain vCard <xref target='RFC6350'/> are also applicable to the JSON representation of vCard.</t>
      <t>As explained in <xref target='RFC4627'/>, JSON is a subset of JavaScript, but it is a safe subset that excludes assignment and invocation.  A JSON text can be safely passed into JavaScript's eval() function (which compiles and executes a string) if all the characters not enclosed in strings are in the set of characters that form JSON tokens.</t>
    </section>

    <section title="IANA Considerations" anchor="iana">
      <t>To follow.</t>
      <t>[[AUTHOR NOTE: We will need to define a Media Type.]]</t>
    </section>

    <section title="Acknowledgements" anchor="acks">
      <t>Some text in this document was borrowed from <xref target='RFC6351'/>.</t>
    </section>

  </middle>

  <back>

    <references title="Normative References">

<reference anchor='RFC2119'>
<front>
<title abbrev='RFC Key Words'>Key words for use in RFCs to Indicate Requirement Levels</title>
<author initials='S.' surname='Bradner' fullname='Scott Bradner'>
<organization>Harvard University</organization>
<address>
<postal>
<street>1350 Mass. Ave.</street>
<street>Cambridge</street>
<street>MA 02138</street></postal>
<phone>- +1 617 495 3864</phone>
<email>sob@harvard.edu</email></address></author>
<date year='1997' month='March' />
<area>General</area>
<keyword>keyword</keyword>
<abstract>
<t>
   In many standards track documents several words are used to signify
   the requirements in the specification.  These words are often
   capitalized.  This document defines these words as they should be
   interpreted in IETF documents.  Authors who follow these guidelines
   should incorporate this phrase near the beginning of their document:

<list>
<t>
      The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
      NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and
      "OPTIONAL" in this document are to be interpreted as described in
      RFC 2119.
</t></list></t>
<t>
   Note that the force of these words is modified by the requirement
   level of the document in which they are used.
</t></abstract></front>
<seriesInfo name='BCP' value='14' />
<seriesInfo name='RFC' value='2119' />
<format type='TXT' octets='4723' target='http://www.rfc-editor.org/rfc/rfc2119.txt' />
<format type='HTML' octets='17491' target='http://xml.resource.org/public/rfc/html/rfc2119.html' />
<format type='XML' octets='5777' target='http://xml.resource.org/public/rfc/xml/rfc2119.xml' />
</reference>

<reference anchor='RFC4627'>
<front>
<title>The application/json Media Type for JavaScript Object Notation (JSON)</title>
<author initials='D.' surname='Crockford' fullname='D. Crockford'>
<organization /></author>
<date year='2006' month='July' />
<abstract>
<t>JavaScript Object Notation (JSON) is a lightweight, text-based, language-independent data interchange format.  It was derived from the ECMAScript Programming Language Standard.  JSON defines a small set of formatting rules for the portable representation of structured data.  This memo provides information for the Internet community.</t></abstract></front>
<seriesInfo name='RFC' value='4627' />
<format type='TXT' octets='16319' target='http://www.rfc-editor.org/rfc/rfc4627.txt' />
</reference>

<reference anchor='RFC6350'>
<front>
<title>vCard Format Specification</title>
<author initials='S' surname='Perreault' fullname='Simon Perreault'>
    <organization />
</author>
<date month='May' day='26' year='2011' />
<abstract><t>This document defines the vCard data format for representing and exchanging a variety of information about individuals and other entities (e.g., formatted and structured name and delivery addresses, email address, multiple telephone numbers, photograph, logo, audio clips, etc.).</t></abstract>
</front>
<seriesInfo name='Internet-Draft' value='draft-ietf-vcarddav-vcardrev-22' />
<format type='TXT'
        target='http://www.ietf.org/internet-drafts/draft-ietf-vcarddav-vcardrev-22.txt' />
</reference>

    </references>

    <references title="Informative References">

<reference anchor='RFC6351'>
<front>
<title>xCard: vCard XML Representation</title>
<author initials='S.' surname='Perreault' fullname='S. Perreault'>
<organization /></author>
<date year='2011' month='August' />
<abstract>
<t>This document defines the XML schema of the vCard data format. [STANDARDS-TRACK]</t></abstract></front>
<seriesInfo name='RFC' value='6351' />
<format type='TXT' octets='34086' target='http://www.rfc-editor.org/rfc/rfc6351.txt' />
</reference>

    </references>

  </back>

</rfc>
